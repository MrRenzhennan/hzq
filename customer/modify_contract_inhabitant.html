<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" >
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title>居民合同详情</title>
    <base href="../">
    <link href="assets/global/plugins/bootstrap-fileinput/fileinput.css" rel="stylesheet">
    <script src="pages/scripts/header.js"></script>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/previewPicture/css/component.css"/>
    <script type="text/javascript" src="assets/global/plugins/previewPicture/js/modernizr.custom.js"></script>

    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-select/bootstrap-select.min.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/select2/select2.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/jquery-multi-select/css/multi-select.css"/>
    <!-- BEGIN THEME STYLES -->
    <link href="assets/global/css/components.css" rel="stylesheet" type="text/css"/>
    <link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>

</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed page-quick-sidebar-over-content ">
<!-- BEGIN HEADER -->
<div class="page-header navbar navbar-fixed-top">
    <script>$.include("pages/partial/menu.shtml");</script>
</div>
<!-- END HEADER -->
<div class="clearfix">
</div>
<!-- BEGIN CONTAINER -->
<div class="page-container">
    <!-- BEGIN SIDEBAR -->
    <div class="page-sidebar-wrapper">
        <script>$.include("pages/partial/sidebar.shtml");</script>
    </div>
    <!-- END SIDEBAR -->
    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <div class="page-content">
            <!-- BEGIN PAGE HEADER-->
            <div class="row">
                <div class="col-md-12">
                    <!-- BEGIN PAGE TITLE & BREADCRUMB-->
                    <ul class="page-breadcrumb breadcrumb">
                        <!-- <li>
                            <i class="fa fa-map-marker"></i>
                            <a href="javascript:;">客户管理</a>
                            <i class="fa fa-angle-right"></i>
                        </li>
                        <li>
                            <a href="javascript:;">合同管理</a>
                            <i class="fa fa-angle-right"></i>
                        </li>
                        <li>
                            <a href="customer/inhabitant_contractManagement.html">居民合同管理</a>
                            <i class="fa fa-angle-right"></i>
                        </li>
                        <li>
                            <a href="javascript:;">居民合同详情</a>
                        </li> -->
                    </ul>
                    <!-- END PAGE TITLE & BREADCRUMB-->
                </div>
            </div>
            <!-- END PAGE HEADER-->
            <!-- BEGIN PAGE CONTENT-->
            <div class="container-fluid">
                <div class="add-form">
                    <form role="form" onsubmit="return false" method="post" id="form">
                        <div class="form-body">
                            <div class="row form-group">
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">合同编号：</label>
                                    <div class="col-md-8">
                                        <input name="contractNo" type="text" class="form-control" placeholder="合同编号" readonly required>
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">用气人:</label>
                                    <div class="col-md-8">
                                        <input name="useGasPerson" type="text" class="form-control" placeholder="用气人" required  readonly>
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="control-label col-md-2">地址:</label>
                                    <div class="col-md-10">
                                        <input name="useGasAddress" type="text" class="form-control" placeholder="地址" readonly>
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>


                            </div>
                            <div class="row form-group">
                                <div class="col-md-3" id="dg_signuptime">
                                    <label class="control-label col-md-4" data-date-format="yyyy-mm-dd"
                                           id="dl_unbolttime">签约时间:</label>
                                    <div class="col-md-8 date-picker input-daterange" data-date-format="yyyy-mm-dd"
                                         id="di_signuptime">
                                        <input name="signupTime" id="signuptime" type="text"
                                               class="form-control form-control-inline date-picker" placeholder="签订时间" required>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">表型:</label>
                                    <div class="col-md-8">
                                        <select id="find_customerType" name="customerType" class="form-control input-middle select2me"
                                                data-placeholder="表型..." required>
                                            <option value=""></option>
                                            <option value="I">IC卡表</option>
                                            <option value="P">普表</option>
                                        </select>
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <label class="control-label col-md-4">代办人:</label>
                                    <div class="col-md-8">
                                        <input name="proxyer" type="text" class="form-control" placeholder="代办人">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">代办人手机:</label>
                                    <div class="col-md-8">
                                        <input name="proxyerTel" type="text" class="form-control" placeholder="代办人手机">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>


                            </div>

                            <div class="row form-group">
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">代办人身份证:</label>
                                    <div class="col-md-8">
                                        <input name="proxyerId" type="text" class="form-control" placeholder="代办人身份证" >
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                                <div class="col-md-9">
                                    <label class="control-label col-md-1">备注:</label>
                                    <div class="col-md-10">
                                        <input name="remark" type="text" class="form-control" placeholder="备注">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                               <!-- <input id="contractType" name="contractType" hidden="hidden" type="text" value="1">
                                <input id="contractState" name="contractState" hidden="hidden" type="text" value="3">
                                <input id="areaId" name="areaId" hidden="hidden" type="text">-->
                            </div>
                            <div id="qunit-fixture" class="row">
                                <!-- The file upload form used as target for the file upload widget -->
                                <form id="fileupload"  onsubmit="return false" enctype="multipart/form-data">
                                    <div class="col-sm-12 form-group">
                                        <div class="btn-group input-group" style="width: 100%">
                                            <div class="input-group-addon">上传数据:</div>
                                            <input class="file-loading form-control" type="file" name="files[]"  multiple>
                                        </div>
                                    </div>
                                    <table role="presentation" class="table table-striped"><tbody class="files"></tbody></table>
                                </form>
                            </div>
                            <div class="picture col-sm-12">
                                <script>$.include("common/picture.shtml");</script>
                            </div>
                            <div class="form-actions fluid">
                                <div class="btn-set">
                                    <button id="cancel_btn" type="button" class="btn default">取消&nbsp;</button>
                                    <script>
                                        $("#cancel_btn").on('click', function () {
                                            history.go("-1")
                                        })
                                    </script>
                                    <button id="save_btn" type="submit" class="btn blue">修改</button>
                                </div>
                            </div>
                        </div>
                    </form>
                    <!--end form-->
                </div>
            </div>
            <!-- END PAGE CONTENT-->
        </div>
    </div>
    <!-- END CONTENT -->
</div>
<!-- END CONTAINER -->
<script>$.include("pages/partial/scripts.shtml");</script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-fileinput/fileinput.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-fileinput/zh.js"></script>
<script type="text/javascript" src="pages/scripts/refhelper.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-select/bootstrap-select.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/select2/select2.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/jquery-multi-select/js/jquery.multi-select.js"></script>
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script type="text/javascript" src="assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>
<script type="text/javascript"
        src="assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="pages/scripts/jquery.json.min.js"></script>
<script type="text/javascript" src="pages/scripts/jquery.serialize-object.min.js"></script>
<script src="assets/admin/pages/scripts/components-pickers.js"></script>
<script type="text/javascript" src="mods/service.js"></script>
<!--end previewPicture-->
<script type="text/javascript">
//    new CBPGridGallery(document.getElementById('grid-gallery'));
</script>
</body>
<!-- END BODY -->
<script>
    ComponentsPickers.init();
    $('.file-loading').fileinput({
        language: 'zh'
    })

    SideBar.init();
    SideBar.activeCurByPage("contract_inhabitant.html");
    var href = document.location.href;
    var contractId = href.substring(href.indexOf("?")+1, href.lenth);
    $('.contractId').val(contractId);
    $.ajax({
        url:hzq_rest + "gasctmcontract/"+contractId,
        type:"GET",
        dateType:"json",
        success:function(data){
            if(data.reservedField2){
                pic(data.reservedField2)
            }else{
                $('.picture').attr("hidden", true);
            }
            $('input,textarea,select').each(function (index) {



                if($(this).attr("name") == 'agreement'){
                    var select = $(this).find('option');
                    for(var i=0;i<select.length;i++){
                        if(select.eq(i).val()== data[$(this).attr('name')]){
                            $(this).find('option').eq(i).attr("selected","selected");
                        }
                    }
                }else if($(this).attr("name") == 'signupTime'){
                    if(data[$(this).attr('name')]){
                        $(this).val(data[$(this).attr('name')].substring(0,10));
                    }
                }else if($(this).attr("name") == 'gasType'){
                    console.log(data[$(this).attr('name')]);
                    var select = $(this).find('option');
                    for(var i=0;i<select.length;i++){
                        if(select.eq(i).val()== data[$(this).attr('name')]){
                            console.log(data[$(this).attr('name')]);
                            $(this).find('option').eq(i).attr("selected",true);
                        }
                    }
                }else if($(this).attr("name") == 'customerType'){
                    console.log(data[$(this).attr('name')]);
                    var select = $(this).find('option');
                    for(var i=0;i<select.length;i++){
                        if(select.eq(i).val()== data[$(this).attr('name')]){
                            console.log(data[$(this).attr('name')]);
                            $(this).find('option').eq(i).attr("selected",true).trigger("change");
                        }
                    }
                }else{
                    $(this).val(data[$(this).attr('name')]);
                }
            });
            for (var i = 0; i < $('.time').length; i++) {
                console.log($('.time').eq(i).val())
                $('.time').eq(i).val($('.time').eq(i).val().split("T")[0]);
            }
        }
    });

//    上传图片
    var busiId;
    $(document).on("click", '.fileinput-upload-button', function (e) {
        e.preventDefault()
        busiId = $.md5(JSON.stringify(document.getElementById('form'))+ new Date().getTime())
        var form = new FormData(document.getElementById('form'));
        console.log(form.get("files[]"));
        $.ajax({
            url: "/hzqs/sys/upload.do?busiId="+busiId,
            data: form,
            dataType: 'text',
            processData: false,
            contentType: false,
            async: false,
            type: 'POST',
            success: function (data) {
                console.log(JSON.stringify(data));
                console.log(JSON.parse(data));

                if (JSON.parse(data).length != 0) {
                    bootbox.alert('导入成功！');
                } else {
                    bootbox.alert("导入失败！");
                }
            },
            error: function (data) {
                console.log(data);
                if(data.status == '413'){
                    bootbox.alert("文件不能超过1M");
                }
                $("#fileId").val('');
            }
        });
    });

    $("#form").on("submit",function(e){
        e.preventDefault();
        var form = $("#form").serializeObject();
        form["reservedField2"] = busiId;
        console.log(form);
        console.log(contractId);
        $.ajax({
            url:hzq_rest + "gasctmcontract/"+contractId,
            headers:{
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type:"PUT",
            dateType:"json",
            data:JSON.stringify(form),
            success:function(data){
                console.log(data)
                if(data.success){
                    bootbox.alert("修改成功",function(){
                        window.location.href = "customer/contract_inhabitant.html";
                    })
                }
            }
        })
    })
</script>
</html>