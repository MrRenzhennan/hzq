<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zh">
<!--<![endif]-->

<!-- BEGIN HEAD -->

<head>
    <title>下线表管理</title>
    <base href="../../">
    <script src="pages/scripts/header.js"></script>
    <meta http-equiv="content-type" content="text/html" charset="utf-8" />
    <link href='assets/global/plugins/jquery-watable/watable.css' rel='stylesheet' />
    <link href='assets/global/plugins/jquery-watable/animate.min.css' rel='stylesheet' />

    <!--datapicker start-->
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-datepicker/css/datepicker3.css" />
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css"
    />
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-colorpicker/css/colorpicker.css" />
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css" />
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-datetimepicker/css/datetimepicker.css" />
    <!--datapicker end-->

    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-select/bootstrap-select.min.css" />
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/select2/select2.css" />
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/jquery-multi-select/css/multi-select.css" />
    <link href="assets/global/css/components.css" rel="stylesheet" type="text/css" />
    <link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css" />
    <style>
        #archive>div {
            margin-bottom: 15px;
        }

        #divtable td:last-child {
            cursor: pointer;
        }

        table {
            cursor: default;
        }
    </style>
</head>
<!-- END HEAD -->

<body class="page-header-fixed page-quick-sidebar-over-content">

    <!-- 标题栏开始 -->
    <div class="page-header navbar navbar-fixed-top">
        <script>$.include("pages/partial/menu.shtml");</script>
    </div>
    <!-- 标题栏结束 -->
    <div class="clearfix"></div>
    <div class="page-container">
        <!-- 左侧菜单开始 -->
        <div class="page-sidebar-wrapper">
            <script>$.include("pages/partial/sidebar.shtml");</script>
        </div>
        <!-- 左侧菜单结束 -->

        <!-- 主内容开始 -->
        <div class="page-content-wrapper">
            <div class="page-content">
                <!--内容头开始-->
                <div class="row">
                    <div class="col-md-12">
                        <ul class="page-breadcrumb breadcrumb">
                        </ul>
                    </div>
                </div>
                <!-- 内容头结束-->

                <!-- 内容开始-->


                <!-- 内容结束-->
                <div class="tabbable tabbable-custom tabbable-custom-profile col-md-12" style="padding-bottom:0px">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#tab22" data-toggle="tab" style="font-size: 14px;color: blue;">
                                重新上线申请的表具信息 </a>
                        </li>
                    </ul>
                    <!--/row-->
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab22">
                            <div class="portlet-body">
                                <!-- begin form-->
                                <div class="row">
                                    <div class="col-sm-3 form-group">
                                        <div class="btn-group input-group  input-select2me">
                                            <div class="input-group-addon">仓库名称:</div>
                                            <input id="meterName" type="text" class="inputclear form-control" readonly>
                                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-3 form-group">
                                        <div class="btn-group input-group input-select2me">
                                            <div class="input-group-addon">表编号:</div>
                                            <input id="meterCode" type="text" class="inputclear form-control" readonly>
                                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-3 form-group">
                                        <div class="btn-group input-group  input-select2me">
                                            <div class="input-group-addon">表具类型:</div>
                                            <input id="meterTypeId" type="text" class="inputclear form-control" readonly>
                                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-3 form-group">
                                        <div class="btn-group input-group  input-select2me">
                                            <div class="input-group-addon">物品种类:</div>
                                            <input id="resKind" type="text" class="inputclear form-control" readonly>
                                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-3 form-group">
                                        <div class="btn-group input-group  input-select2me">
                                            <div class="input-group-addon">厂家名称:</div>
                                            <input id="factoryName" type="text" class="inputclear form-control" readonly>
                                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-3 form-group">
                                        <div class="btn-group input-group  input-select2me">
                                            <div class="input-group-addon">表具规格型号:</div>
                                            <input id="meterModelId" type="text" class="inputclear form-control" readonly>
                                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-3 form-group">
                                        <div class="btn-group input-group  input-select2me">
                                            <div class="input-group-addon">流量范围:</div>
                                            <input id="flowRange" type="text" class="inputclear form-control" readonly>
                                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-3 form-group">
                                        <div class="btn-group input-group" style="width: 100% !important;">
                                            <div class="input-group-addon">申请原因:</div>
                                            <select id="reason" name="direction"
                                                    class="select2-container form-control select2me"
                                                    data-placeholder="请选择..." disabled>
                                                <option value=""></option>
                                                <option value="1">维修</option>
                                                <option value="2">操作错误</option>
                                            </select>
                                        </div>
                                    </div>
                                    
				                    <div class="col-md-12 form-group">
                                        <div class="btn-group input-group" style="width: 100% !important;">
                                            <div class="input-group-addon">备注:</div>
					                        <textarea id="remark" value="" maxlength="2000" size="2000" class="col-md-12 form-control" style="height: 100px;" readonly></textarea>
                                        </div>
                                    </div>
                                    <script>$.include("common/picture.shtml");</script>
                                </div>




                                <!--end form-->
                            </div>
                        </div>
                    </div>
                </div>
                <script>
                    $.include("examine/commons/commit_examine_common.shtml");
                </script>
                <div class="clearfix">
                </div>
            </div>
        </div>
        <!-- 主内容结束 -->
    </div>



    <script type="text/javascript">$.include("pages/partial/xwatable-form.shtml")</script>
</body>


<script>$.include("pages/partial/scripts.shtml");</script>
<script src="assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script type="text/javascript" src="assets/global/plugins/jquery-watable/jquery.watable.js"></script>
<script type="text/javascript" src="pages/scripts/rqlbuilder.js"></script>
<script type="text/javascript" src="pages/scripts/xwatable.js"></script>
<script type="text/javascript" src="pages/scripts/refhelper.js"></script>

<!--datapicker start-->
<script type="text/javascript" src="assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/clockface/js/clockface.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>

<script type="text/javascript" src="assets/global/plugins/bootstrap-select/bootstrap-select.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/select2/select2.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/jquery-multi-select/js/jquery.multi-select.js"></script>

<script src="pages/scripts/jquery.json.min.js"></script>
<script type="text/javascript" src="pages/scripts/jquery.serialize-object.min.js"></script>
<script src="assets/admin/pages/scripts/components-pickers.js"></script>

<script src="mods/timeslot.js"></script>
<script src="mods/basismanage.js"></script>
<script src="mods/ctm.js"></script>
<script type="text/javascript">


    var meterId;
    var userinfo = JSON.parse(localStorage.getItem('user_info'));
    var userId = JSON.parse(localStorage.getItem("user_info")).userId;
    var doBusi = function(step) {
        var onlineApplyId = JSON.parse(step.propstr2048).meter_reonline_id;
        console.log(step.results);
        if (step.results == "0") {
            var submitJson = {
                "sets": [
                    { "txid": "1", "body": {"stockState": "1", "modifiedTime": new Date(new Date() + "-00:00"), "modifiedBy": userId }, "path": "/gasmtrmeter/" + meterId, "method": "PUT" },
                    { "txid": "2", "body": { "status": "1", "modifiedTime": new Date(new Date() + "-00:00"), "modifiedBy": userId }, "path": "/gasmtrmeterreonline/" + onlineApplyId, "method": "PUT" },
                    // {"txid":"3","body":movedetail,"path":"/gasmtrmetermovedetail/","method":"POST"},
                    // {"txid":"4","body":flowjson,"path":"/hzqs/psm/pbisn.do?fh=VFLSCGC000000J00&bd={}&resp=bd/","method":"POST"},
                ]
            };

            $.ajax({
                type: 'POST',
                url: "/hzqs/dbc/pbtxs.do?fh=SELDBC0000000J00&resp=bd",
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                async: false,
                isMask: true,
                data: JSON.stringify(submitJson),
                success: function (data) {
                    console.log(meterId);
                  

                    var retFlag = true;
                    for (var i = 0; i < data.results.length; i++) {
                        if (!data.results[i].result.success) {
                            retFlag = false;
                            break;
                        }
                    }
                    if (retFlag) {

                    } else {

                                          
                    }
                },
                error: function (err) {
                    if (err.status == 406) {
                        if (window.location.pathname.indexOf('/login.html') < 0) {
                            window.location.replace("/login.html?redirect=" + window.location.pathname);
                        }
                    }
                }
            });
        }else{
            var submitJson = {
                "sets": [
                    { "txid": "1", "body": { "status": "2", "modifiedTime": new Date(new Date() + "-00:00"), "modifiedBy": userId }, "path": "/gasmtrmeterreonline/" + onlineApplyId, "method": "PUT" },
                    // {"txid":"3","body":movedetail,"path":"/gasmtrmetermovedetail/","method":"POST"},
                    // {"txid":"4","body":flowjson,"path":"/hzqs/psm/pbisn.do?fh=VFLSCGC000000J00&bd={}&resp=bd/","method":"POST"},
                ]
            };

            $.ajax({
                type: 'POST',
                url: "/hzqs/dbc/pbtxs.do?fh=SELDBC0000000J00&resp=bd",
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                async: false,
                isMask: true,
                data: JSON.stringify(submitJson),
                success: function (data) {
                    var retFlag = true;
                    for (var i = 0; i < data.results.length; i++) {
                        if (!data.results[i].result.success) {
                            retFlag = false;
                            break;
                        }
                    }
                    if (retFlag) {

                    } else {

                                          
                    }
                },
                error: function (err) {
                    if (err.status == 406) {
                        if (window.location.pathname.indexOf('/login.html') < 0) {
                            window.location.replace("/login.html?redirect=" + window.location.pathname);
                        }
                    }
                }
            });
        }
        /* $.ajax({
            url: "hzqs/hzqrest/gasmtrmeterreonline/" + onlineApplyId,
            type: "PUT",
            dataType: "json",
            async: false,
            data: JSON.stringify({
                "modified_time": new Date().getTime(),
                "status": applyState
            }),
            success: function (data) {
                var finishTimeJson;
                finishTimeJson = {
                    "finishTime": new Date()
                }

                var flow_result = Restful.update("/hzqs/dbc/pbtxs.do?fh=SELDBC0000000J00&resp=bd", onlineApplyId, finishTimeJson);
                if (flow_result.retcode == "0") {
                    //表具状态 下线
                    Restful.update("hzqs/hzqrest/gasmtrmeter/", meterId, statusJson);
                } else {

                }

            }
        }); */
    }

    $(function () {
        var onlineApplyId = JSON.parse(step.propstr2048).meter_reonline_id;

        $.ajax({
            url: "hzqs/dbc/pbsel.do?fh=SELDBC0000000J00&resp=bd",
            type: "POST",
            async: false,
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({
                cols: "mmr.*,mm.meter_no,mf.factory_name,mm.meterNo,mms.meter_model_name,mr.reskind_name,mmt.meter_type_name, md.depository_name,mmf.flow_name",
                froms: "gas_mtr_meter_reonline mmr,gas_mtr_meter mm,gas_mtr_meter_reonline b,gas_mtr_factory mf, gas_mtr_meterspec mms,gas_mtr_reskind mr,gas_mtr_meter_type mmt,gas_mtr_depository md,gas_mtr_meter_flow mmf",
                wheres: "mm.factory_id=mf.factory_id and mms.meter_model_id = mm.meter_model_id and mr.reskind_id =mm.reskind_id and md.depository_id = mm.depository_id and mmt.meter_type_id = mm.meter_type_id and mmf.meter_flow_id = mm.flow_range and mmr.meter_id = mm.meter_id and mmr.meter_reonline_id ='" + onlineApplyId + "'",
                page: "false",
                limit: 1
            }),
            success: function (data) {
            	console.log(data);
                if (data && data.rows && data.rows.length > 0) {
                    var datas = data.rows[0];
                    console.log(datas);
                    $('#meterName').val(datas.depositoryName);//仓库
                    $('#meterCode').val(datas.meterNo);//表编号
                    $('#meterTypeId').val(datas.meterTypeName);//表具类型
                    $('#factoryName').val(datas.factoryName);//厂家
                    $('#meterModelId').val(datas.meterModelName);//表具规格
                    $('#resKind').val(datas.reskindName);//物品种类
                    $('#flowRange').val(datas.flowName);//流量
                    $('#reason').val(datas.reason).trigger("change");//申请原因
                    $('#remark').val(datas.remark);//备注
                    pic(datas.files)
                    meterId = datas.meterId;
                } else {

                }
            },
            error: function () {

            }
        });
    })
</script>
</html>