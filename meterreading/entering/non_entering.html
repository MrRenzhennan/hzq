<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->

<!-- BEGIN HEAD -->
<head>
    <title>抄表录入</title>
    <base href="../../">
    <script src="pages/scripts/basepath.js"></script>

    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-select/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-datepicker/css/datepicker.css"/>

    <link rel="stylesheet" type="text/css" href="assets/global/plugins/select2/select2.css">

    <script src="pages/scripts/header.js"></script>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>
    <link rel='stylesheet' href='assets/global/plugins/jquery-watable/watable.css'/>
    <link rel='stylesheet' href='assets/global/plugins/jquery-watable/animate.min.css'/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/jstree/dist/themes/default/style.min.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/jquery-multi-select/css/multi-select.css"/>
    <!-- BEGIN THEME STYLES -->
    <link href="assets/global/css/components.css" rel="stylesheet" type="text/css"/>
    <link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>
    <!-- END THEME STYLES -->
    <link href="assets/global/plugins/bootstrap-fileinput/fileinput.min.css" rel="stylesheet">
</head>
<body class="page-header-fixed page-quick-sidebar-over-content">
<!-- 标题栏开始 -->
<div class="page-header navbar navbar-fixed-top">
    <script>$.include("pages/partial/menu.shtml");</script>
</div>
<!-- 标题栏结束 -->
<div class="clearfix"></div>
<div class="page-container">
    <!-- 左侧菜单开始 -->
    <div class="page-sidebar-wrapper">
        <script>$.include("pages/partial/sidebar.shtml");</script>
    </div>
    <!-- 左侧菜单结束 -->

    <!-- 主内容开始 -->
    <div class="page-content-wrapper">
        <div class="page-content">
            <!--内容头开始-->
            <div class="row">
                <ul class="page-breadcrumb breadcrumb">
                    <li>
                        <i class="fa  fa-map-marker"></i>
                        <a>抄表管理</a>
                        <i class="fa fa-angle-right"></i>
                    </li>
                    <li>

                        <a href="index.html">抄表数据管理</a>
                        <i class="fa fa-angle-right"></i>
                    </li>
                    <li>
                        <a href="javascript:void(0)">抄表录入</a>
                    </li>
                </ul>
            </div>
            <!--内容头结束-->
            <div class="row" class="col-md-12">
                <div class=" col-sm-12" style="padding-bottom:0px">
                    <div class="col-md-2 col-sm-9">
                        <div class="btn-group form-group">
                            <button id="btn_select_book" class="btn btn-primary">
                                请选择抄表本&nbsp; <i class="glyphicon glyphicon-th-list"></i>
                            </button>
                        </div>
                        <div class="portlet blue-hoki box"  id="book_tree" style="display: none">
                            <div class="portlet-title blue">
                                <div class="caption">
                                    请选择抄表本
                                </div>
                            </div>
                            <div class="portlet-body" style="overflow:scroll;height:450px;">
                                <div id="treetable" >
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-md-12 col-sm-12">
                <div class="container-fluid" style="padding:10px 10px 20px 10px;">
                    <div id="divtable" class="table-responsive container-fluid col-md-12"
                         style="padding-top: 10px !important;">
                    </div>
                </div>
                </div>
                <div class="col-md-12" id="information" style="padding-bottom: 30px;">
                        <h6>录入抄表信息</h6>
                    <input id="ctmarchiveid" hidden/>
                        <div class="col-sm-4 form-group">
                            <div class="btn-group input-group">
                                <div class="input-group-addon">上次表读数:</div>
                                <input id="lastmeterreading" class="inputclear form-control" type="text" placeholder="716" readonly>
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group" id="box_lastrevisereading" style="display: none;">
                            <div class="btn-group input-group">
                                <div class="input-group-addon">上次修正表读数:</div>
                                <input id="lastrevisemeterreading" class="inputclear form-control" type="text" placeholder="0" readOnly>
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <div class="btn-group input-group">
                                <div class="input-group-addon">表读数:</div>
                                <input id="meterreading" class="inputclear form-control" type="text" placeholder="716">
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group" id="box_revisereading" style="display: none;">
                            <div class="btn-group input-group">
                                <div class="input-group-addon">修正表读数:</div>
                                <input id="revisemeterreading" class="inputclear form-control" type="text" placeholder="0">
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <div class="btn-group input-group">
                                <div class="input-group-addon">抄表日期:</div>
                                <!--<input id="copytime" class="inputclear form-control" type="date" placeholder="0">
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>-->
                                <div class="input-group input-large date-picker input-daterange" data-date-format="yyyy-mm-dd">
                                    <input id="copytime" type="text" class="form-control" name="from">
                                    <span class="inputclear glyphicon glyphicon-remove-circle hidden" ></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <div class="btn-group input-group">
                                <div class="input-group-addon">计费表:</div>
                                <select id="meterflag" class="form-control input-small select2me" data-placeholder="选择...">
                                    <option value=""></option>
                                    <option value="1">一次表计费</option>
                                    <option value="2">修正表计费</option>
                                </select>
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group" id="box_quotiety" style="display: none;">
                            <div class="btn-group input-group">
                                <div class="input-group-addon">修正系数:</div>
                                <input id="quotiety" class="inputclear form-control" type="text" placeholder="1">
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                    <div class="col-sm-4 form-group" id="box_chagemeterreading" style="display: none;">
                        <div class="btn-group input-group">
                            <div class="input-group-addon">计费读数(m³):</div>
                            <input id="chagemeterreading" class="inputclear form-control" type="text" placeholder="1" >
                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                        </div>
                    </div>
                    <div class="col-sm-4 form-group" id="box_last_remaing_asnum" style="display: none;" hidden>
                        <div class="btn-group input-group">
                            <div class="input-group-addon">上次表内余量:</div>
                            <input id="lastremaingasnum" class="inputclear form-control" type="text" placeholder="1">
                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                        </div>
                    </div>
                    <div class="col-sm-4 form-group" id="box_last_cardbalanceesum" style="display: none;" hidden>
                        <div class="btn-group input-group">
                            <div class="input-group-addon">上次表内余额:</div>
                            <input id="lastcardbalanceesum" class="inputclear form-control" type="text" placeholder="1">
                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                        </div>
                    </div>
                    <div class="col-sm-4 form-group" id="box_last_accumulatedgas" style="display: none;" hidden>
                        <div class="btn-group input-group">
                            <div class="input-group-addon">上次表内累计气量:</div>
                            <input id="lastaccumulatedgas" class="inputclear form-control" type="text" placeholder="1">
                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                        </div>
                    </div>
                        <div class="col-sm-4 form-group" id="box_remaing_asnum" hidden>
                            <div class="btn-group input-group">
                                <div class="input-group-addon">表内余量:</div>
                                <input id="remaingasnum" class="inputclear form-control" type="text" placeholder="1">
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group" id="box_cardbalanceesum" hidden>
                            <div class="btn-group input-group">
                                <div class="input-group-addon">表内余额:</div>
                                <input id="cardbalanceesum" class="inputclear form-control" type="text" placeholder="1">
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group" id="box_accumulatedgas" hidden>
                            <div class="btn-group input-group">
                                <div class="input-group-addon">表内累计气量:</div>
                                <input id="accumulatedgas" class="inputclear form-control" type="text" placeholder="1">
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <div class="btn-group input-group">
                                <div class="input-group-addon">抄表类型:</div>
                                <select id="copytype" class="form-control input-small select2me reading_type"
                                        data-placeholder="选择抄表类型">
                                    <option value=""></option>

                                </select>
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <div class="btn-group input-group">
                                <div class="input-group-addon">预算气量:</div>
                                <input id="find_budgetmeasure" class="inputclear form-control" type="text" placeholder="" >
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>
                        <div class="col-sm-4 form-group">
                            <div class="btn-group input-group">
                                <div class="input-group-addon">预算气费:</div>
                                <input id="find_budgetgasfee" class="inputclear form-control" type="text" placeholder="" >
                                <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                            </div>
                        </div>

                        <script>$.include("meterreading/model/upload.shtml");</script>
                        <div class="col-sm-2 form-group">
                            <button id="showdisgit" class="btn green">
                                预算&nbsp; <i class="fa fa-"></i>
                            </button>
                        </div>
                        <div class="col-sm-2 form-group">
                            <button id="nsButton" class="btn blue">
                                确定&nbsp; <i class="fa fa-"></i>
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<!--<script>$.include("pages/partial/themepanel.shtml");</script>-->
<!-- 内容头结束-->
</div>
</div>
<!-- 内容开始-->

<!-- 内容结束-->


<!-- 主内容结束 -->
<script type="text/javascript">$.include("pages/partial/xwatable-form.shtml")</script>
<script type="text/javascript">$.include("pages/partial/pbooktree.shtml")</script>
<!-- 底边栏开始 -->
<!--<script>$.include("pages/partial/foot.shtml");</script>-->
<!-- 底边栏结束 -->
</div>

<script>$.include("pages/partial/scripts.shtml");</script>
<script src="assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script type="text/javascript" src="assets/global/plugins/jquery-watable/jquery.watable.js"></script>
<script type="text/javascript" src="pages/scripts/rqlbuilder.js"></script>
<script type="text/javascript" src="pages/scripts/xwatable.js"></script>
<script type="text/javascript" src="pages/scripts/refhelper.js"></script>
<script type="text/javascript" src="assets/global/plugins/select2/select2.js"></script>

<script type="text/javascript"
        src="assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="assets/admin/pages/scripts/components-pickers.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<!-- BEGIN PAGE LEVEL SCRIPTS -->

<script type="text/javascript" src="assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>
<script type="text/javascript"
        src="assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="pages/scripts/jquery.json.min.js"></script>
<script type="text/javascript" src="pages/scripts/jquery.serialize-object.min.js"></script>
<script src="assets/admin/pages/scripts/components-pickers.js"></script>
<script type="text/javascript" src="mods/service.js"></script>
<script src="assets/global/plugins/jstree/dist/jstree.min.js"></script>
<script src="assets/admin/pages/scripts/ui-tree.js"></script>
<script src="meterreading/js/meterbuild.js"></script>

<!-- END PAGE LEVEL SCRIPTS -->
<script src="mods/sys.js"></script>
<script src="mods/bas.js"></script>
<script src="mods/mrd.js"></script>
<script src="mods/ctm.js"></script>
<script src="mods/timeslot.js"></script>
<script src="mods/mtr.js"></script>

<script>
    jQuery(document).ready(function () {

        MeterreadingData.init();
        ComponentsPickers.init();
        UITree.init();

    });

</script>

</body>
<script>
    ComponentsPickers.init();
    $('.file-loading').fileinput({
        language: 'zh'
    })

   /* SideBar.init();
    SideBar.activeCurByPage("contract_inhabitant.html");
    var href = document.location.href;
    var contractId = href.substring(href.indexOf("?")+1, href.lenth);
    $('.contractId').val(contractId);
    $.ajax({
        url:hzq_rest + "gasctmcontract/"+contractId,
        type:"GET",
        dateType:"json",
        success:function(data){
            if(data.reservedField2){
                pic(data.reservedField2)
            }else{
                $('.picture').attr("hidden", true);
            }
            $('input,textarea,select').each(function (index) {
                if($(this).attr("name") == 'agreement'){
                    var select = $(this).find('option');
                    for(var i=0;i<select.length;i++){
                        if(select.eq(i).val()== data[$(this).attr('name')]){
                            $(this).find('option').eq(i).attr("selected","selected");
                        }
                    }
                }else if($(this).attr("name") == 'gasType'){
                    console.log(data[$(this).attr('name')]);
                    var select = $(this).find('option');
                    for(var i=0;i<select.length;i++){
                        if(select.eq(i).val()== data[$(this).attr('name')]){
                            console.log(data[$(this).attr('name')]);
                            $(this).find('option').eq(i).attr("selected",true);
                        }
                    }
                }else if($(this).attr("name") == 'customerType'){
                    console.log(data[$(this).attr('name')]);
                    var select = $(this).find('option');
                    for(var i=0;i<select.length;i++){
                        if(select.eq(i).val()== data[$(this).attr('name')]){
                            console.log(data[$(this).attr('name')]);
                            $(this).find('option').eq(i).attr("selected",true).trigger("change");
                        }
                    }
                }else{
                    $(this).val(data[$(this).attr('name')]);
                }
            });
            for (var i = 0; i < $('.time').length; i++) {
                console.log($('.time').eq(i).val())
                $('.time').eq(i).val($('.time').eq(i).val().split("T")[0]);
            }
        }
    });

    //    上传图片
    var busiId;
    $(document).on("click", '.fileinput-upload-button', function (e) {
        e.preventDefault()
        busiId = $.md5(JSON.stringify(document.getElementById('form'))+ new Date().getTime())
        var form = new FormData(document.getElementById('form'));
        console.log(form.get("files[]"));
        $.ajax({
            url: "/hzqs/sys/upload.do?busiId="+busiId,
            data: form,
            dataType: 'text',
            processData: false,
            contentType: false,
            async: false,
            type: 'POST',
            success: function (data) {
                console.log(JSON.stringify(data));
                console.log(JSON.parse(data));

                if (JSON.parse(data).length != 0) {
                    bootbox.alert('导入成功！');
                } else {
                    bootbox.alert("导入失败！");
                }
            },
            error: function (data) {
                console.log(data);
                if(data.status == '413'){
                    bootbox.alert("文件不能超过1M");
                }
                $("#fileId").val('');
            }
        });
    });

    $("#form").on("submit",function(e){
        e.preventDefault();
        var form = $("#form").serializeObject();
        form["reservedField2"] = busiId;
        console.log(form);
        console.log(contractId);
        $.ajax({
            url:hzq_rest + "gasctmcontract/"+contractId,
            headers:{
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type:"PUT",
            dateType:"json",
            data:JSON.stringify(form),
            success:function(data){
                console.log(data)
                if(data.success){
                    bootbox.alert("修改成功",function(){
                        window.location.href = "customer/contract_inhabitant.html";
                    })
                }
            }
        })
    })*/
</script>
</html>