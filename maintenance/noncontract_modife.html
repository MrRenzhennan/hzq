<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zh">
<!--<![endif]-->

<!-- BEGIN HEAD -->
<head>
    <title>非居民合同修改</title>
    <base href="../">
    <script src="pages/scripts/header.js"></script>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-select/bootstrap-select.min.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/select2/select2.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/jquery-multi-select/css/multi-select.css"/>
    <link href="assets/global/plugins/bootstrap-fileinput/fileinput.css" rel="stylesheet">
    <script src="pages/scripts/header.js"></script>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-select/bootstrap-select.min.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/select2/select2.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/jquery-multi-select/css/multi-select.css"/>
    <link href="assets/global/css/components.css" rel="stylesheet" type="text/css"/>
    <link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>

    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-datepicker/css/datepicker3.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-colorpicker/css/colorpicker.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-datetimepicker/css/datetimepicker.css"/>

    <link rel="stylesheet" type="text/css" href="assets/global/plugins/previewPicture/css/component.css" />
    <script type="text/javascript" src="assets/global/plugins/previewPicture/js/modernizr.custom.js"></script>
</head>
<!-- END HEAD -->

<body class="page-header-fixed page-quick-sidebar-over-content">

<!-- 标题栏开始 -->
<div class="page-header navbar navbar-fixed-top">
    <script>$.include("pages/partial/menu.shtml");</script>
</div>
<!-- 标题栏结束 -->
<div class="clearfix"></div>
<div class="page-container">
    <!-- 左侧菜单开始 -->
    <div class="page-sidebar-wrapper">
        <script>$.include("pages/partial/sidebar.shtml");</script>
    </div>
    <!-- 左侧菜单结束 -->

    <!-- 主内容开始 -->
    <div class="page-content-wrapper">
        <div class="page-content">
            <!--内容头开始-->
            <div class="row">
                <div class="col-md-12">
                    <ul class="page-breadcrumb breadcrumb">
                        <li>
                            <i class="fa fa-map-marker"></i>
                            <a href="javascript:;">运维管理</a>
                            <i class="fa fa-angle-right"></i>
                        </li>
                        <li>
                            <a href="javascript:;">非居民合同</a>
                            <i class="fa fa-angle-right"></i>
                        </li>
                        <li>
                            <a href="javascript:;">非居民合同修改</a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- 内容头结束-->

            <!-- 内容开始-->
            <div class="container-fluid contract">
                <div class="add-form ">
                    <!-- begin form-->
                    <form action="javascript:;" role="form" id="form">
                        <div class="form-body" id="contract">
                            <div class="row form-group">
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">合同编号:</label>
                                    <div class="col-md-8">
                                        <input id="contractNo" name="contractNo" type="text" class="form-control" placeholder="合同编号">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <label class="control-label col-md-4">用气人:</label>
                                    <div class="col-md-8">
                                        <input name="useGasPerson" type="text" class="form-control" placeholder="用气人">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <label class="control-label col-md-4">用气地址:</label>
                                    <div class="col-md-8">
                                        <input name="useGasAddress" type="text" class="form-control" placeholder="用气地址">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <label class="control-label col-md-4">表型:</label>
                                    <div class="col-md-8">
                                        <select id="find_customerType" name="customerType" class="form-control input-middle select2me"
                                                data-placeholder="表型...">
                                            <option value=""></option>
                                            <option value="I">IC卡表</option>
                                            <option value="P">普表</option>
                                        </select>
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="row form-group">
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">用气类型:</label>
                                    <div class="col-md-8">
                                        <select id="gasType" name="gasType" class="form-control input-middle select2me"
                                                data-placeholder="用气类型...">
                                            <option value=""></option>
                                        </select>
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                                <!-- <div class="col-md-3">
                                     <label class="control-label col-md-4">用气性质:</label>
                                     <div class="col-md-8">
                                         <select id="gasType1" name="gasType" class="form-control input-middle select2me"
                                                 data-placeholder="用气性质...">
                                             <option value=""></option>
                                         </select>
                                         <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                     </div>
                                 </div>-->
                                <div class="col-md-3" id="dg_signuptime">
                                    <label class="control-label col-md-4" data-date-format="yyyy-mm-dd"
                                           id="dl_unbolttime">签约时间:</label>
                                    <div class="col-md-8 date-picker input-daterange" data-date-format="yyyy-mm-dd"
                                         id="di_signuptime">
                                        <input name="signupTime" id="signuptime" type="text"
                                               class="form-control form-control-inline date-picker" placeholder="签订时间">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="control-label col-md-4" data-date-format="yyyy-mm-dd">起始时间:</label>
                                    <div class="col-md-8 date-picker input-daterange" data-date-format="yyyy-mm-dd">
                                        <!--<input name="beginDate" data-date-format="yyyy-mm-dd" type="text"
                                               class="form-control form-control-inline  form_accuracy_datetime"
                                               placeholder="起始时间">-->
                                        <input name="beginDate" id="startDate" type="text"
                                               class="form-control form-control-inline date-picker" placeholder="起始时间">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="control-label col-md-4" data-date-format="yyyy-mm-dd">截止时间:</label>
                                    <div class="col-md-8 date-picker input-daterange" data-date-format="yyyy-mm-dd">
                                        <input name="endDate" id="endDate" type="text"
                                               class="form-control form-control-inline date-picker" placeholder="截止时间">
                                    </div>
                                </div>
                            </div>
                            <div class="row form-group">

                                <div class="col-md-3">
                                    <label class="control-label col-md-4">合同年限:</label>
                                    <div class="col-md-8">
                                        <input name="contractYearLimit" type="text" class="form-control" placeholder="合同年限" maxlength="3">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">合同状态:</label>
                                    <div class="col-md-8">
                                        <select id="find_contractState" name="contractState" class="form-control input-middle select2me" data-placeholder="合同状态...">

                                        </select>
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">合同类别:</label>
                                    <div class="col-md-8">
                                        <select name="contractType" class="form-control input-middle select2me"
                                                data-placeholder="合同类别...">
                                            <option value=""></option>
                                            <option value="1">普通合同</option>
                                            <option value="2">增容合同</option>
                                            <option value="3">减容合同</option>
                                            <option value="4">煤改气合同</option>
                                            <option value="5">养老机构合同</option>
                                        </select>
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <label class="control-label col-md-4">有无补充协议:</label>
                                    <div class="col-md-8">
                                        <select name="agreement" class="form-control input-middle select2me"
                                                data-placeholder="有无补充协议...">
                                            <option value=""></option>
                                            <option value="0">有</option>
                                            <option value="1">没有</option>
                                        </select>
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>



                            </div>

                            <div class="row form-group">
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">代办人:</label>
                                    <div class="col-md-8">
                                        <input name="proxyer" type="text" class="form-control" placeholder="代办人">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">代办人手机:</label>
                                    <div class="col-md-8">
                                        <input name="proxyerTel" type="text" class="form-control" placeholder="代办人手机">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="control-label col-md-4">代办人身份证:</label>
                                    <div class="col-md-8">
                                        <input name="proxyerId" type="text" class="form-control" placeholder="代办人身份证">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>


                                <!--<input id="gasKind" name="gasKind" hidden="hidden" type="text" value="9">-->
                                <!--<input id="areaId" name="areaId" hidden="hidden" type="text" value="1">-->


                                <div class="col-md-12" style="margin-top: 10px; margin-left: -7px;">
                                    <label class="control-label col-md-1">备注:</label>
                                    <div class="col-md-11">
                                        <input name="remark" type="text" class="form-control" placeholder="备注">
                                        <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                                    </div>
                                </div>
                            </div>


                        </div>

                    </form>
                    <!--end form-->
                </div>
            </div>

            <div class="row form-group">
                <div class="col-md-12">
                    <label class="control-label">相关照片</label>
                    <div id="grid-gallery" class="grid-gallery">
                        <section class="grid-wrap">
                            <ul id="grid" class="grid">
                                <li class="grid-sizer"></li>
                            </ul>
                        </section>
                        <section class="slideshow" style="padding-top: 10px">
                            <ul id = "slideId">
                            </ul>
                            <nav>
                                <span class="icon nav-prev"></span>
                                <span class="icon nav-next"></span>
                                <span class="icon nav-close" style="padding-top: 50px;"></span>
                            </nav>
                        </section>
                    </div>
                </div>
            </div>

            <div class="form-actions" style="margin-bottom:50px; ">
                <div class="btn-set">
                    <button id="sav_btn" type="button" class="btn blue">保存&nbsp;</button>
                    <button id="cancel" type="button" class="btn red">返回&nbsp;</button>
                    <script>
                        $(function () {
                            $('#cancel').click(function () {
                                history.go("-1");
                            });
                        });
                    </script>
                </div>
            </div>
            <!-- 内容结束-->
        </div>
    </div>

    <!-- 主内容结束 -->


</div>


<script type="text/javascript">$.include("pages/partial/xwatable-form.shtml")</script>

<!-- 底边栏开始 -->
<script>$.include("pages/partial/foot.shtml");</script>
<!-- 底边栏结束 -->
</body>


<script>$.include("pages/partial/scripts.shtml");</script>

<script src="pages/scripts/rest.js" type="text/javascript"></script>
<script src="assets/addons/jquery-dateFormat.min.js" type="text/javascript"></script>
<script type="text/javascript" src="assets/global/plugins/jquery-watable/jquery.watable.js"></script>
<script type="text/javascript" src="pages/scripts/rqlbuilder.js"></script>
<script type="text/javascript" src="pages/scripts/xwatable.js"></script>
<script type="text/javascript" src="pages/scripts/refhelper.js"></script>

<script type="text/javascript" src="pages/scripts/userinfo.js"></script>
<script type="text/javascript" src="pages/scripts/jquery.serialize-object.min.js"></script>
<script src="assets/admin/pages/scripts/components-pickers.js"></script>
<script type="text/javascript" src="pages/scripts/refhelper.js"></script>

<script type="text/javascript" src="assets/global/plugins/previewPicture/js/imagesloaded.pkgd.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/previewPicture/js/masonry.pkgd.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/previewPicture/js/classie.js"></script>
<script type="text/javascript" src="assets/global/plugins/previewPicture/js/cbpGridGallery.js"></script>

<script type="text/javascript" src="assets/global/plugins/bootstrap-select/bootstrap-select.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/select2/select2.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/jquery-multi-select/js/jquery.multi-select.js"></script>


<script type="text/javascript" src="assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/clockface/js/clockface.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript"
        src="assets/global/plugins/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="assets/admin/pages/scripts/components-pickers.js"></script>


<script>
    ComponentsPickers.init();
//    new CBPGridGallery(document.getElementById('grid-gallery'));
    var contractId = Metronic.getURLParameter("refno");
    var gasTypeHelper = RefHelper.create({
        ref_url: "gasbizgastype/" + '?query={"parentTypeId":"3"}"',
        ref_col: "gasTypeId",
        ref_display: "gasTypeName"
    });
    $.map(gasTypeHelper.getData(), function (value, key) {
        $('#gasType').append('<option value="' + key + '">' + value + '</option>');
    });
    var contractStatus = {"0": "预签", "1": "新签", "2": "正常", "3": "即将到期", "4": "到期", "5": "过期","6":"续签","7":"作废","9":"未通过"};
    $.each(contractStatus,function(key,val){
        $("#find_contractState").append("<option value='"+key+"'>"+val+"</option>");
    });

    console.log(contractId);
    var result = Restful.getByID(hzq_rest+"gasctmcontract",contractId);
    $.each(result,function(key,val){
        if(key=="signupTime" || key == "beginDate" || key=="endDate"){
            $("#form input[name='"+key+"']").val(val.substring(0,10));
        }else{
            $("#form input[name='"+key+"']").val(val);
        }

       $("#form select[name='"+key+"']").val(val).trigger("change");

    });
    var pics ="";
    if(result.reservedField2){
        pics =result.reservedField2.split(",");
    }
    $.each(pics,function(index){
        pic(pics[index]);
    });
    function pic(busiId){
        $.ajax({
            url: hzq_rest+"gasbasfile?fields={}&query={\"busiId\":\"" + busiId + "\"}",
            method: "get",
            async: false,
            dataType: "json",
            success: function (data) {
                console.log(data)
                if(data && data.length > 0){
                    for(var i=0; i<data.length;i++){
                        var datali = data[i];
                        $("#grid").append("<li><figure><img src='/hzqs/sys/download.do?fileId="+datali.fileId+"&w=300' alt='"+datali.fileName+"'/></figure></li>")
                        $("#slideId").append("<li><figure><img src='/hzqs/sys/download.do?fileId="+datali.fileId+"' alt='"+datali.fileName+"'/></figure></li>")
                    }
                }
                console.log("ssdsds"+JSON.stringify(data));
            },
            error: function (data) {
                bootbox.alert(data);
            }
        });
        setTimeout(function(){
            new CBPGridGallery(document.getElementById('grid-gallery'));
        },300)
    }
    var resultq ="";
    $("#contractNo").on("change",function(){
        console.log($(this).val())
        resultq = Restful.findNQ( hzq_rest +'gasctmcontract/?query={"contractNo":"'+$(this).val()+'"}');
        console.log(resultq);
        if(resultq.length>0 && ($(this).val()!= result.contractNo) ){
            bootbox.alert("<center><h4>该合同编号已经存在，请更换合同编号。</h4></center>");
            $("#sav_btn").attr("disabled","disabled");
        }else{
            console.log("111")
            $("#sav_btn").removeAttr("disabled")
        }
    })

        $("#sav_btn").on("click",function(){
            bootbox.confirm("<center><h4>确定修改吗?</h4></center>", function(result) {
                if(result===false){

                }else {
                    var form=$("#form").serializeObject();
                    console.log(form);
                    var mmodiferesult = Restful.update(hzq_rest +"gasctmcontract",contractId,form)
                    console.log(mmodiferesult)
                    if(mmodiferesult){
                        history.go("-1")
                    }else{
                        bootbox.alert("<center><h4>修改失败。</h4></center>");
                    }

                }
            })
        })




</script>

</html>