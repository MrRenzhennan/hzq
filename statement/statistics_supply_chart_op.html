<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>
    <title>近三年供销差率对比</title>
    <script src="../pages/scripts/basepath.js"></script>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-select/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/select2/select2.css">
    <script src="../pages/scripts/header.js"></script>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>
    <link href='../assets/global/plugins/jquery-watable/watable.css' rel='stylesheet'/>
    <link href='../assets/global/plugins/jquery-watable/animate.min.css' rel='stylesheet'/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css"/>
    <link href='../assets/global/plugins/bootstrap-datetimepicker/css/datetimepicker.css' rel='stylesheet'/>

    <!--datapicker css start-->
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-datepicker/css/datepicker3.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-colorpicker/css/colorpicker.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-datetimepicker/css/datetimepicker.css"/>
    <!--datapicker end-->

    <link rel="stylesheet" href="/statement/css/3.3.7/bootstrap.min.css">
</head>

<body class="page-header-fixed page-quick-sidebar-over-content">

<!-- 标题栏开始 -->
<div class="page-header navbar navbar-fixed-top">
    <script>$.include("pages/partial/menu.shtml");</script>
</div>
<!-- 标题栏结束 -->
<div class="clearfix"></div>
<div class="page-container">
    <!-- 左侧菜单开始 -->
    <div class="page-sidebar-wrapper">
        <script>$.include("pages/partial/sidebar.shtml");</script>
    </div>
    <!-- 左侧菜单结束 -->

    <!-- 主内容开始 -->
    <div class="page-content-wrapper">
        <div class="page-content">
            <!--内容头开始-->
            <!--内容头开始-->
            <div class="row noneprint">
                <div class="col-md-12">
                    <ul class="page-breadcrumb breadcrumb">
                        <li>
                            <i class="fa fa-map-marker"></i>
                            <a href="index.html">报表统计</a>
                            <i class="fa fa-angle-right"></i>
                        </li>
                        <li>
                            <a href="javascript:void(0)">近三年供销差率对比</a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- 内容头结束-->
            <div class="container-fluid">
                <br>
                <div class="row">
                    <div class="col-sm-10">
                        <form class="form-horizontal">
                            <h4>录入气量</h4>
                            <hr>
                            <div class="form-group">
                                <label for="inputEmail3" class="col-sm-2 control-label">选择类型</label>
                                <div class="col-sm-10">
                                <select class="form-control" name="type" id="type">
                                    <option value="1">购气量</option>
                                    <option value="2">销气量</option>
                                </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inputEmail3" class="col-sm-2 control-label">年</label>
                                <div class="col-sm-10">
                                <input type="input" class="form-control" id="year" name="year" placeholder="请输入年，如：2017">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inputEmail3" class="col-sm-2 control-label">操作类型</label>
                                <div class="col-sm-10">
                                <select class="form-control" name="op" id="op">
                                    <option value="1">新增</option>
                                    <option value="2">修改</option>
                                    <option value="3">删除</option>
                                </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="inputPassword3" class="col-sm-2 control-label">数据</label>
                                <div class="col-sm-10">
                                <textarea class="form-control" name="data" id="data" rows="15" placeholder="请按行输入,每行一个月"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-10">
                                <button type="button" id="add" class="btn btn-default">保存</button>
                                </div>
                            </div>
                            <br>
                        </form>
                    </div>                    
                </div>
                
            </div>
            <!-- 内容结束-->
        </div>
    </div>
    <!-- 主内容结束 -->
</div>

<!-- 底边栏开始 -->
<script>$.include("pages/partial/foot.shtml");</script>
<!-- 底边栏结束 -->
</body>


<script>$.include("pages/partial/scripts.shtml");</script>
<!--跳到原稿-->
<script src="../assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script type="text/javascript" src="../assets/global/plugins/jquery-watable/jquery.watable.js"></script>
<script type="text/javascript" src="../pages/scripts/rqlbuilder.js"></script>
<script type="text/javascript" src="../pages/scripts/xwatable.js"></script>
<script type="text/javascript" src="../pages/scripts/refhelper.js"></script>

<!--datapicker start-->
<script type="text/javascript" src="../assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="../assets/global/plugins/clockface/js/clockface.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="../assets/admin/pages/scripts/components-pickers.js"></script>

<script type="text/javascript" src="../assets/global/plugins/select2/select2.js"></script>

<script type="text/javascript" src="/statement/js/libs/charts/echarts.js"></script>
<script type="text/javascript" src="/statement/js/libs/charts/echarts-gl.js"></script>
<script>
    function isInt(value){
        return /^[0-9]*$/.test(value);
    }
    function isNumber(value){
        return /^[0-9]+(.[0-9]{2})?$/.test(value);
    }
    $(function(){
        
        $("#add").on("click",function(){
            var year=$("#year").val();
            var type=$("#type").val();
            var op=$("#op").val();
            var datas=$("#data").val().split('\n');
            if(year==""){
                alert("请输入年");
                return;
            }
            if(!isInt(year)){
                alert("年应该是数字");
                return;
            }
            
            if(op==1){
                if(datas.length!=12){
                    alert("请输入12个月的");
                    return;
                }
                var data=[];
                datas.forEach(function(m,i){
                    if(!isNumber(m)){

                    }
                    data.push({year:year,month:(i+1),type:type,val:m,supplyId:year+"#"+(i+1)+"#"+type});
                })
                $.ajax({
                    url: "hzqs/hzqrest/gasreportsupply/?retobj=1",
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify(data),
                    dataType: "json",
                    success: function (data) {   
                        console.log("data",data);
                        alert(data.description);
                    }
                });
            }else if(op==3){
                var typename="购气量";
                if(type==2)typename="销气量";
                if(confirm("确认删除"+year+"年"+typename)){
                    var paramter=[];
                    for(i=0;i<12;i++){
                        paramter.push({supplyId:year+"#"+(i+1)+"#"+type});
                    }
                    $.ajax({
                        url: "hzqs/hzqrest/gasreportsupply/",
                        type: "delete",
                        contentType: "application/json;charset=utf-8",
                        data: JSON.stringify(paramter),
                        dataType: "json",
                        success: function (data) {   
                            console.log("data",data);
                        }
                    });

                }
            }else if(op==2){
                var data=[]
                datas.forEach(function(m,i){
                    data.push({year:year,month:(i+1),type:type,val:m,supplyId:year+"#"+(i+1)+"#"+type});
                })
                var paramter=[];
                for(i=0;i<12;i++){
                    paramter.push({supplyId:year+"#"+(i+1)+"#"+type});
                }
                
                $.ajax({
                    url: "hzqs/hzqrest/gasreportsupply/",
                    type: "delete",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify(paramter),
                    dataType: "json",
                    success: function (result) {   
                        console.log("result",result);
                        if(result.success==true){
                            $.ajax({
                                url: "hzqs/hzqrest/gasreportsupply/?retobj=1",
                                type: "POST",
                                contentType: "application/json;charset=utf-8",
                                data: JSON.stringify(data),
                                dataType: "json",
                                success: function (data) {   
                                    console.log("data",data);
                                    alert(data.description);
                                }
                            });
                        }
                    }
                });
            }           
            
        })
        
    })
</script>
</body>
</html>