<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>
    <title>近三年销气量同期对比</title>
    <script src="../pages/scripts/basepath.js"></script>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-select/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/select2/select2.css">
    <script src="../pages/scripts/header.js"></script>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>
    <link href='../assets/global/plugins/jquery-watable/watable.css' rel='stylesheet'/>
    <link href='../assets/global/plugins/jquery-watable/animate.min.css' rel='stylesheet'/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css"/>
    <link href='../assets/global/plugins/bootstrap-datetimepicker/css/datetimepicker.css' rel='stylesheet'/>

    <!--datapicker css start-->
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-datepicker/css/datepicker3.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-colorpicker/css/colorpicker.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-datetimepicker/css/datetimepicker.css"/>
    <!--datapicker end-->

    <link rel="stylesheet" href="/statement/css/3.3.7/bootstrap.min.css">
</head>

<body class="page-header-fixed page-quick-sidebar-over-content">

<!-- 标题栏开始 -->
<div class="page-header navbar navbar-fixed-top">
    <script>$.include("pages/partial/menu.shtml");</script>
</div>
<!-- 标题栏结束 -->
<div class="clearfix"></div>
<div class="page-container">
    <!-- 左侧菜单开始 -->
    <div class="page-sidebar-wrapper">
        <script>$.include("pages/partial/sidebar.shtml");</script>
    </div>
    <!-- 左侧菜单结束 -->

    <!-- 主内容开始 -->
    <div class="page-content-wrapper">
        <div class="page-content">
            <!--内容头开始-->
            <!--内容头开始-->
            <script>$.include("common/navigation_bar.shtml");</script>
            <!-- 内容头结束-->

            <!-- 内容开始-- >

            <div class="container col-sm-12 noneprint" style="padding-bottom:0px">
                <div class="row">

                    <div class="col-sm-3 form-group">
                        <div class="btn-group input-group">
                            <div class="input-group-addon" style="border:0px;">月份：</div>
                            <div id="div_date" class="input-group input-large date-picker input-daterange" data-date="11/2012" data-date-format="yyyy年mm月">
                                <input id="find_date" type="text" class="form-control" name="from">
                                <span class="inputclear glyphicon glyphicon-remove-circle hidden" ></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3 form-group">
                    </div>
                    <div class="col-sm-3 form-group">
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <button id="find_sign" type="button" class="btn yellow">
                                查询 <i class="fa fa-search"></i>
                            </button>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <button id="btn_print_page" onclick="window.print()" type="button" class="btn gray disabled" >
                                打印<i class="glyphicon"></i>
                            </button>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <button id="btn_down_detail" type="button" class="btn gray disabled export-excel">
                                导出<i class="glyphicon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            < !-- 内容头结束-->



            <div class="container-fluid">
                <br/>
                <div>
                    <table cellSpacing="0" cellPadding="2" width="95%" align="center" border="0">
                        <tr>
                            <td id="table_0_title" align="center" title="">近三年销气量同期对比</td>
                        </tr>
                    </table>
                </div>
                <br/>
                <div id="main" style="height:400px"></div>
                <table class="tabPrint table-bordered table-hover table-condensed " align="center" cellSpacing="0" cellPadding="0" border="0"
                       id="table_0">
                    <thead style="display:table-header-group;font-weight:bold"
                           mce_style="display:table-header-group;font-weight:bold">
                    <tr align="center">
                        <td id="table_0_thead_r1_c1" rowspan="1" colspan="1">&nbsp;&nbsp;&nbsp;&nbsp;2017供销量&nbsp;&nbsp;&nbsp;&nbsp;</td>
                        <td id="table_0_thead_r1_c2" rowspan="1" colspan="1">&nbsp;&nbsp;&nbsp;&nbsp;2016供销量&nbsp;&nbsp;&nbsp;&nbsp;</td>
                        <td id="table_0_thead_r1_c4" rowspan="1" colspan="1">&nbsp;&nbsp;&nbsp;&nbsp;2015供销量&nbsp;&nbsp;&nbsp;&nbsp;</td>
                    </tr>
                    </thead>
                    <tbody id="table_0_tbody">
                    <tr align="center">
                        <td id="table_0_tbody_r1_c1" rowspan="1" colspan="1">0</td>
                        <td id="table_0_tbody_r1_c2" rowspan="1" colspan="1">0</td>
                        <td id="table_0_tbody_r1_c4" rowspan="1" colspan="1">0</td>
                    </tr>
                    </tbody>
                </table>
                <br/><br/>
                <br/><br/></div>
            <!-- 内容结束-->
        </div>
    </div>
    <!-- 主内容结束 -->
</div>

<!-- 底边栏开始 -->
<script>$.include("pages/partial/foot.shtml");</script>
<!-- 底边栏结束 -->
</body>


<script>$.include("pages/partial/scripts.shtml");</script>
<!--跳到原稿-->
<script src="../assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script type="text/javascript" src="../assets/global/plugins/jquery-watable/jquery.watable.js"></script>
<script type="text/javascript" src="../pages/scripts/rqlbuilder.js"></script>
<script type="text/javascript" src="../pages/scripts/xwatable.js"></script>
<script type="text/javascript" src="../pages/scripts/refhelper.js"></script>

<!--datapicker start-->
<script type="text/javascript" src="../assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="../assets/global/plugins/clockface/js/clockface.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="../assets/admin/pages/scripts/components-pickers.js"></script>

<script type="text/javascript" src="../assets/global/plugins/select2/select2.js"></script>

<script type="text/javascript" src="/statement/js/libs/charts/echarts.js"></script>
<script type="text/javascript" src="/statement/js/libs/charts/echarts-gl.js"></script>
<script type="text/javascript">
    // 基于准备好的dom，初始化echarts图表
    var myChart = echarts.init(document.getElementById('main'));

    var title = "近三年销气量同期对比";

    var year=moment().format('YYYY');

    var option = {
        tooltip: {
            show: true
        },
        legend: {
            data:['销气量']
        },
        xAxis : [
            {
                type : 'category',
                data : [year+"年销气量",(year-1)+"年销气量",(year-2)+'年销气量']
            }
        ],
        yAxis : [
            {
                type : 'value'
            }
        ],
        series : [
            {
                "name":"销气量",
                "type":"bar",
                "data":[0,0,0]
            }
        ]
    };
    /**
    select e.report_year,e.report_month,e.price,e.gas,e.sse,e.ysl_id,f.base_price,a.non_rsdt_dct_id,a.customer_name name,
    b.ctm_archive_id,c.customer_code,c.customer_name,d.area_name,d.area_id,c.gas_type_id,f.gas_type_name,case when e.customer_type='I' then 'IC卡' else '普表' end customer_type
from GAS_BLL_NONRSDT_DCT a 
    inner join GAS_BLL_NONRSDT_DCT_CTM b on a.non_rsdt_dct_id=b.non_rsdt_dct_id and b.status=1
    inner join gas_ctm_Archive c on c.ctm_archive_id=b.ctm_archive_id
    inner join gas_biz_Area d on c.area_id=d.area_id
    inner join gas_report_ysl e on c.customer_code=e.customer_code
    inner join gas_biz_gas_type f on f.gas_type_id=substr(c.gas_type_id,0,3) and f.pos_Code = 0
    left join gas_report_nonrsdt_baseprice f on f.ysl_id=e.ysl_id
    */
    // 为echarts对象加载数据
    myChart.setOption(option);
    function getNum(data,year){
        var num=0;
        data.forEach(function(m){
            if(m.year==year){
                num=m.gas;
            }
        })
        return num;
    }
    $(function(){
        $.ajax({
            url: "hzqs/dbc/pbsel.do?fh=SELDBC0000000J00&resp=bd",
            type: "POST",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({
                cols: "sum(gas) gas,reportYear year",
                froms: "gasReportYslNew",
                wheres: "reportYear in ("+year+","+(year-1)+","+(year-2)+") group by reportYear",
                page: "false"
            }),
            dataType: "json",
            success: function (data) {
                console.log("data",data)  
                if(data.rows){
                    $("#table_0_tbody_r1_c1").html(getNum(data.rows,year));
                    $("#table_0_tbody_r1_c2").html(getNum(data.rows,year-1));
                    $("#table_0_tbody_r1_c4").html(getNum(data.rows,year-2));

                    var val=[getNum(data.rows,year),getNum(data.rows,year-1),getNum(data.rows,year-2)];
                    option.series[0].data=val;
                    myChart.setOption(option);
                } 
            }
        });
    }) 
</script>
</body>
</html>