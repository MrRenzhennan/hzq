<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zh">
<!--<![endif]-->

<!-- BEGIN HEAD -->
<head>
    <title>新增量、存量统计报表</title>
    <script src="../pages/scripts/basepath.js"></script>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-select/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/select2/select2.css">
    <script src="../pages/scripts/header.js"></script>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>
    <link href='../assets/global/plugins/jquery-watable/watable.css' rel='stylesheet'/>
    <link href='../assets/global/plugins/jquery-watable/animate.min.css' rel='stylesheet'/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css"/>
    <link href='../assets/global/plugins/bootstrap-datetimepicker/css/datetimepicker.css' rel='stylesheet'/>

    <!--datapicker css start-->
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-datepicker/css/datepicker3.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-colorpicker/css/colorpicker.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/global/plugins/bootstrap-datetimepicker/css/datetimepicker.css"/>

    <link rel="stylesheet" href="statement/css/3.3.7/bootstrap.min.css">
    <link href='../assets/global/css/bootstrap-monthpicker.css' rel='stylesheet'/>
    <!--datapicker end-->
    <style>
        @media print {
            .noneprint {
                display: none;
            }
        }

        .tabPrint td {
            border-left: #000000 solid 1px;
            border-top: #000000 solid 1px;
            height: 21px;
        }

        table.tabPrint {
            border-right: #000000 solid 1px;
            border-bottom: #000000 solid 1px;
        }

        .nextPage {
            page-break-after: always;
        }

        .linetd {
            border-bottom: solid 1px #000;
        }
    </style>
</head>
<!-- END HEAD -->

<body class="page-header-fixed page-quick-sidebar-over-content">

<!-- 标题栏开始 -->
<div class="page-header navbar navbar-fixed-top">
    <script>$.include("pages/partial/menu.shtml");</script>
</div>
<!-- 标题栏结束 -->
<div class="clearfix"></div>
<div class="page-container">
    <!-- 左侧菜单开始 -->
    <div class="page-sidebar-wrapper">
        <script>$.include("pages/partial/sidebar.shtml");</script>
    </div>
    <!-- 左侧菜单结束 -->

    <!-- 主内容开始 -->
    <div class="page-content-wrapper">
        <div class="page-content">
            <!--内容头开始-->
            <!--内容头开始-->
            <div class="row noneprint">
                <div class="col-md-12">
                    <ul class="page-breadcrumb breadcrumb">
                        <li>
                            <i class="fa fa-map-marker"></i>
                            <a href="index.html">报表统计</a>
                            <i class="fa fa-angle-right"></i>
                        </li>
                        <li>
                            <a href="javascript:void(0)">新增量、存量统计报表</a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- 内容头结束-->

            <!-- 内容开始-->

            <div class="container col-sm-12 noneprint" style="padding-bottom:0px">
                <div class="row">

                    <div class="col-sm-3 form-group">
                        <div class="btn-group input-group">
                            <div class="input-group-addon" style="border:0px;">月份：</div>
                            <div id="div_date" class="input-group input-daterange" data-date="11/2012" data-date-format="yyyy年mm月">
                                <input id="find_date" type="text" class="form-control" name="from">
                                <span class="inputclear glyphicon glyphicon-remove-circle hidden" ></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3 form-group">
                    </div>
                    <div class="col-sm-3 form-group">
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <button id="find_sign" type="button" class="btn yellow">
                                查询 <i class="fa fa-search"></i>
                            </button>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <button id="btn_print_page" onclick="window.print()" type="button" class="btn gray disabled" >
                                打印<i class="glyphicon"></i>
                            </button>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <button id="btn_down_detail" type="button" class="btn gray disabled export-excel">
                                导出<i class="glyphicon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 内容头结束-->

            <div class="container-fluid">
                <div>
                    <table cellSpacing="0" cellPadding="2" width="95%" align="center" border="0">
                        <tr>
                            <td id="title" align="center" title="">新增量、存量统计报表</td>
                        </tr>
                    </table>
                </div>
                <br/>
                <div>
                    <table cellSpacing="0" cellPadding="2" width="95%" align="center" border="0">
                        <tr>
                            <td id="head_r0_c1" rowspan="1" colspan="1" width="85%" align="left">制表单位：哈尔滨中庆燃气有限责任公司营业部</td>
                            <td id="head_r0_c2" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c3" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c4" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c5" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c6" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c7" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c8" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c9" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c10" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c11" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c12" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c13" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c14" rowspan="1" colspan="1"></td>
                            <td id="head_r0_c15" rowspan="1" colspan="1" width="20%" align="right">单位:万立方米，万元</td>
                        </tr>
                    </table>
                </div>
                <table class="tabPrint table-bordered table-hover table-condensed " align="center" width="95%" cellSpacing="0" cellPadding="0" border="0"
                       ID="Table2">
                    <thead style="display:table-header-group;font-weight:bold"
                           mce_style="display:table-header-group;font-weight:bold">
                    <tr align="center">
                        <td id="thead_r1_c1" rowspan="3" colspan="1">单位</td>
                        <td id="thead_r1_c2" rowspan="1" colspan="4">总量完成（实收）</td>
                        <td id="thead_r1_c6" rowspan="1" colspan="4"><span id="curmonth"></span>年新增用户</td>
                        <td id="thead_r1_c10" rowspan="1" colspan="4">存量用户</td>
                        <td id="thead_r1_c14" rowspan="1" colspan="4">内部自用气</td>
                        <td id="thead_r1_c18" rowspan="1" colspan="4">实际完成</td>
                    </tr>
                    <tr align="center">
                        <td id="thead_r2_c2" rowspan="1" colspan="2">销售量</td>
                        <td id="thead_r2_c4" rowspan="1" colspan="2">销售额</td>
                        <td id="thead_r2_c6" rowspan="1" colspan="2">销售量</td>
                        <td id="thead_r2_c8" rowspan="1" colspan="2">销售额</td>
                        <td id="thead_r2_c10" rowspan="1" colspan="2">销售量</td>
                        <td id="thead_r2_c12" rowspan="1" colspan="2">销售额</td>
                        <td id="thead_r2_c14" rowspan="1" colspan="2">免收量</td>
                        <td id="thead_r2_c16" rowspan="1" colspan="2">免收额</td>
                        <td id="thead_r2_c18" rowspan="1" colspan="2">销售量</td>
                        <td id="thead_r2_c20" rowspan="1" colspan="2">销售额</td>
                    </tr>
                    <tr align="center">
                        <td id="thead_r3_c2" rowspan="1" colspan="1">本月</td>
                        <td id="thead_r3_c3" rowspan="1" colspan="1">累计</td>
                        <td id="thead_r3_c4" rowspan="1" colspan="1">本月</td>
                        <td id="thead_r3_c5" rowspan="1" colspan="1">累计</td>
                        <td id="thead_r3_c6" rowspan="1" colspan="1">本月</td>
                        <td id="thead_r3_c7" rowspan="1" colspan="1">累计</td>
                        <td id="thead_r3_c8" rowspan="1" colspan="1">本月</td>
                        <td id="thead_r3_c9" rowspan="1" colspan="1">累计</td>
                        <td id="thead_r3_c10" rowspan="1" colspan="1">本月</td>
                        <td id="thead_r3_c11" rowspan="1" colspan="1">累计</td>
                        <td id="thead_r3_c12" rowspan="1" colspan="1">本月</td>
                        <td id="thead_r3_c13" rowspan="1" colspan="1">累计</td>
                        <td id="thead_r3_c14" rowspan="1" colspan="1">本月</td>
                        <td id="thead_r3_c15" rowspan="1" colspan="1">累计</td>
                        <td id="thead_r3_c16" rowspan="1" colspan="1">本月</td>
                        <td id="thead_r3_c17" rowspan="1" colspan="1">累计</td>
                        <td id="thead_r3_c18" rowspan="1" colspan="1">本月</td>
                        <td id="thead_r3_c19" rowspan="1" colspan="1">累计</td>
                        <td id="thead_r3_c20" rowspan="1" colspan="1">本月</td>
                        <td id="thead_r3_c21" rowspan="1" colspan="1">累计</td>
                    </tr>
                    </thead>
                    <tbody id="tbody">

                    </tbody>
                </table>
                <br/>
                <div>
                    <table cellSpacing="0" cellPadding="2" width="95%" align="center" border="0">
                        <tr>
                            <td id="foot_r0_c1" rowspan="1" colspan="1">负责人：</td>
                            <td id="foot_r0_c2" rowspan="1" colspan="1" width="35%"></td>
                            <td id="foot_r0_c3" rowspan="1" colspan="1"></td>
                            <td id="foot_r0_c4" rowspan="1" colspan="1"></td>
                            <td id="foot_r0_c5" rowspan="1" colspan="1"></td>
                            <td id="foot_r0_c6" rowspan="1" colspan="1"></td>
                            <td id="foot_r0_c7" rowspan="1" colspan="1">制表人：</td>
                            <td id="foot_r0_c8" rowspan="1" colspan="1" width="15%"></td>
                            <td id="foot_r0_c9" rowspan="1" colspan="1"></td>
                            <td id="foot_r0_c10" rowspan="1" colspan="1"></td>
                            <td id="foot_r0_c11" rowspan="1" colspan="1"></td>
                            <td id="foot_r0_c12" rowspan="1" colspan="1"></td>
                            <td id="foot_r0_c13" rowspan="1" colspan="1" width="20%"></td>
                            <td id="foot_r0_c14" rowspan="1" colspan="1">填报日期：</td>
                            <td id="foot_r0_c15" rowspan="1" colspan="1"></td>
                        </tr>
                    </table>
                </div>
                <br/><br/></div>
            <!-- 内容结束-->
        </div>
    </div>
    <!-- 主内容结束 -->
</div>

<!-- 底边栏开始 -->
<script>$.include("pages/partial/foot.shtml");</script>
<!-- 底边栏结束 -->
</body>


<script>$.include("pages/partial/scripts.shtml");</script>
<!--跳到原稿-->
<script src="../assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script type="text/javascript" src="../assets/global/plugins/jquery-watable/jquery.watable.js"></script>
<script type="text/javascript" src="../pages/scripts/rqlbuilder.js"></script>
<script type="text/javascript" src="../pages/scripts/xwatable.js"></script>
<script type="text/javascript" src="../pages/scripts/refhelper.js"></script>

<!--datapicker start-->
<script type="text/javascript" src="../assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript"
        src="../assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="../assets/global/plugins/clockface/js/clockface.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
<script type="text/javascript" src="../assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="../assets/admin/pages/scripts/components-pickers.js"></script>

<script type="text/javascript" src="../assets/global/plugins/select2/select2.js"></script>
<script type="text/javascript" src="../assets/global/scripts/bootstrap-monthpicker.js"></script>


<script src="/statement/js/libs/js-xlsx/xlsx.core.min.js" type="text/javascript"></script>
<script src="/statement/js/libs/html2canvas/html2canvas.min.js" type="text/javascript"></script>
<script src="/statement/js/tableExport.js" type="text/javascript"></script>
<script src="/statement/js/datehelper.js" type="text/javascript"></script>

<script type="text/javascript">

    $(".export-excel").attr("data-table",".tabPrint");
    $(".export-excel").on("click", function (e) {
        e.preventDefault();
        var exportTable = $(this).data("table");
        var filename = $("#title").html();//$(this).data("filename");
        var ignoreColumn = "";//$(this).data("ignorecolumn");
        $(exportTable).tableExport({
            fileName: filename,
            type: 'excel',
            escape: 'false',
            excelstyles: ['border-bottom', 'border-top', 'border-left', 'border-right'],
            ignoreColumn: '[' + ignoreColumn + ']'
        });
    });

    jQuery(document).ready(function () {
        ComponentsPickers.init();
        $('#find_date').bootstrapMonthpicker();
    });

    document.onkeydown = function () {keydown();};
    function keydown() {
        //P 空格 会车 event.keyCode==80 || event.keyCode==32 || event.keyCode==13
        if (event.keyCode == 13) {
            window.print();
        }
    }

    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null)return decodeURIComponent(r[2]);
        return null;
    }

    function toAmount(amount) {
        var numArray = amount.toString().split(".");

        if (numArray.length > 1) {
            console.log("##amount="+amount+"##"+amount.toString().split(".").length+"##"+numArray[1].length);
            if (numArray[1].length < 2) {
                amount = amount + "0";
            }else if (numArray[1].length > 2) {
                amount = numArray[0] + "." + numArray[1].substring(0, 2);
            }
        } else {
            amount = amount + ".00";
        }
        //return (amount * 1);//字符串变数字
        return amount;
    }

    function date_format(date, fmt) {
        var dataJson = {
            "M+": date.getMonth() + 1, //月份
            "d+": date.getDate(), //日
            "h+": date.getHours(), //小时
            "m+": date.getMinutes(), //分
            "s+": date.getSeconds(), //秒
            "q+": Math.floor((date.getMonth() + 3) / 3), //季度
            "S": date.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in dataJson)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (dataJson[k]) : (("00" + dataJson[k]).substr(("" + dataJson[k]).length)));
        return fmt;
    }

    function edit(id) {
        var v = $("#"+id).html();
        $("#"+id).html("<input type='number' id='"+id+"_text' oldid='"+id+"' oldvalue='"+v+"' value='"+v+"' onblur='outEdit(this.id)'/>");
        $("#"+id+"_text").focus();
    }
    function outEdit(id) {
        var ov = $("#"+id).attr("oldvalue");
        var oid = $("#"+id).attr("oldid");
        $("#"+oid).html($("#"+id).val());
    }

    function operationData(operationDataJson) {
        for (var i = 0; i < operationDataJson.length; i++) {
            var inputCols = operationDataJson[i].ic;
            var operator = operationDataJson[i].op;
            var out = $("#tbody_" + inputCols[0]).html() * 1;
            for (var j = 1; j < inputCols.length; j++) {
                var value = $("#tbody_" + inputCols[j]).html() * 1;
                if (operator == "+") {
                    out = out + value;
                }
            }
            var outputColType = operationDataJson[i].ty;
            var outputCol = operationDataJson[i].oc;
            if (outputColType && outputColType == "f") {
                $("#tbody_" + outputCol).html(toAmount(out + ""));
            } else {
                $("#tbody_" + outputCol).html(out);
            }

        }
    }
    function getReportAreaIdNum(data,areaid){
        var ysl=0,money=0.00;
        if(data){
            data.forEach(function(o){
                if(o.areaId){    
                    //建档案数
                    if( o.areaId==areaid){ 
                        if(o.ysl)ysl+=o.ysl;
                        if(o.money)money+=o.money;
                    }
                }
            });
        }
        
        return {ysl:ysl,money:money};
    }

    $(function () {
        $("#find_date").val(date_format(new Date(),"yyyy-MM"));
        $("#title").html($("#find_date").val()+"&nbsp;&nbsp;新增量、存量统计报表");


        $("#curmonth").html(moment($("#find_date").val()).format('YYYY'));
        var areas = new Array();
        var area_id = JSON.parse(localStorage.getItem("user_info")).area_id;
        areas.push(area_id);
        //查询areaId下级areaId
        var queryCondion = RQLBuilder.and([
            RQLBuilder.equal("status", "1"),
            RQLBuilder.equal("parentAreaId", area_id)
        ]).rql()
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: 'get',
            async: false,
            url: hzq_rest + "gasbizarea?query=" + queryCondion,
            success: function (data) {
                for (var i = 0; i < data.length; i++) {
                    areas.push(data[i].areaId);
                }
            }
        });
        var AreaHelper1 = RefHelper.create({
            ref_url: 'gasbizarea?query={"areaId":{"$in":' + JSON.stringify(areas) + '}}',
            ref_col: "areaId",
            ref_display: "areaName",
            "sort": "posCode"
        });
        var gs = AreaHelper1.getRawData();
        var tbody = "";
        for (var i = 0; i < gs.length; i++) {
            tbody = tbody + '<tr align="center" data-areaid="'+gs[i].areaId+'">' +
                '<td id="tbody_r'+gs[i].areaId+'_c1" rowspan="1" colspan="1">' + gs[i].areaName + '</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c2" rowspan="1" colspan="1">0</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c3" rowspan="1" colspan="1">0</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c4" rowspan="1" colspan="1">0.00</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c5" rowspan="1" colspan="1">0.00</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c6" rowspan="1" colspan="1">0</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c7" rowspan="1" colspan="1">0</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c8" rowspan="1" colspan="1">0.00</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c9" rowspan="1" colspan="1">0.00</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c10" rowspan="1" colspan="1">0</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c11" rowspan="1" colspan="1">0</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c12" rowspan="1" colspan="1">0.00</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c13" rowspan="1" colspan="1">0.00</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c14" rowspan="1" colspan="1">0</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c15" rowspan="1" colspan="1">0</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c16" rowspan="1" colspan="1">0.00</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c17" rowspan="1" colspan="1">0.00</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c18" rowspan="1" colspan="1">0</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c19" rowspan="1" colspan="1">0</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c20" rowspan="1" colspan="1">0.00</td>' +
                '<td id="tbody_r'+gs[i].areaId+'_c21" rowspan="1" colspan="1">0.00</td>' +
                '</tr>';
        }
        tbody = tbody + '<tr align="left">' +
            '<td id="tbody_r19_c1" rowspan="2" colspan="21">&nbsp;&nbsp;&nbsp;&nbsp;注：</td>' +
            '</tr>';
        $("#tbody").html(tbody);

        //查询按钮时间
        $("#find_sign").click(function() {
            if ($("#find_date").val() == "") {
                bootbox.alert("请您选择要查询的月份！");
                return;
            }
            $("#title").html($("#find_date").val()+"&nbsp;&nbsp;新增量、存量统计报表");
            var userInfo = JSON.parse(localStorage.getItem("user_info"));
            if(userInfo.employee_name){
                $("#foot_r0_c8").html(userInfo.employee_name);
            }else{
                $("#foot_r0_c8").html("管理员");
            }
            $("#foot_r0_c15").html(date_format(new Date(),"yyyy-MM-dd"));

            $("#btn_down_detail").removeClass("disabled");
            $("#btn_down_detail").removeClass("gray");
            $("#btn_down_detail").addClass("green");

            $("#btn_print_page").removeClass("disabled");
            $("#btn_print_page").removeClass("gray");
            $("#btn_print_page").addClass("green");

            //报表时间是上月26日到当月26日
            var curMonth=$("#find_date").val().replace('年','-').replace('月','');   
            //月末         
            var end = dateHelper.getMonthEnd(curMonth);
            //月初
            var start = dateHelper.getMonthStart(curMonth);
            //获取当年年初
            var startYear=dateHelper.getCurYearMonthStart(curMonth);
            //当年
            var year=dateHelper.getCurYear(curMonth);
            
            //当月
            var month=parseInt(dateHelper.getCurMonth(curMonth));
            //上年上月 {prevmonth:"",prevyear:""};考虑跨年
            var prev=dateHelper.getPrevMonth(curMonth);
            //上年
            var prevyear=dateHelper.getPrevYear(curMonth);

            $("#curmonth").html(year);
            //总完成 本月实收量和实收额
            var whereClause2=" reportYear="+year+" and reportMonth="+month;
            //当年 新增用户 本月销量和本月销售额
            var whereClause6_8=" reportYear="+year+" and reportMonth="+month
            whereClause6_8+=" and unboltTime between to_date('"+startYear+"','yyyy-MM-dd') and to_date('"+end+"','yyyy-MM-dd')";
            
            var whereClause14_16=" reportYear="+year+" and reportMonth="+month
            whereClause14_16+=" and gasTypeId like '308%'";
            var areaIdTotal=1;
            $.when(
                //总完成 本月实收量和实收额
                $.ajax({
                    url: "hzqs/dbc/pbsel.do?fh=SELDBC0000000J00&resp=bd",
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({
                        cols: "sum(ysl) ysl,sum(money) money, areaId",
                        froms: "gasReportSseNewDiff",
                        wheres: whereClause2 + " group by areaId",
                        page: "false",
                    }),
                    dataType: "json",
                    success: function (data) {
                        var yslTotal=0,moneyTotal=0.00;
                        $("#tbody").find("tr").each(function(){
                            var areaId=$(this).data("areaid");
                            var m=getReportAreaIdNum(data.rows,areaId) ;
                            if(areaId!=areaIdTotal){
                                yslTotal+=m.ysl;
                                moneyTotal+=m.money;
                            } 
                            $(this).find("#tbody_r"+areaId+"_c2").html((m.ysl));       
                            $(this).find("#tbody_r"+areaId+"_c4").html(m.money.toFixed(2));      
                        })
                        //$("#tbody_r1_c2").html(yslTotal);       
                        $("#tbody_r1_c4").html(moneyTotal.toFixed(2));
                    }
                }),
                //当年 新增用户 本月销量和本月销售额
                $.ajax({
                    url: "hzqs/dbc/pbsel.do?fh=SELDBC0000000J00&resp=bd",
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({
                        cols: "sum(ysl) ysl,sum(money) money, areaId",
                        froms: "gasReportSseNewDiff",
                        wheres: whereClause6_8 + " group by areaId",
                        page: "false",
                    }),
                    dataType: "json",
                    success: function (data) {
                        var yslTotal=0,moneyTotal=0.00;
                        $("#tbody").find("tr").each(function(){
                            var areaId=$(this).data("areaid");
                            var m=getReportAreaIdNum(data.rows,areaId) ;
                            if(areaId!=areaIdTotal){
                                yslTotal+=m.ysl;
                                moneyTotal+=m.money;
                            } 
                            $(this).find("#tbody_r"+areaId+"_c6").html(m.ysl);       
                            $(this).find("#tbody_r"+areaId+"_c8").html(m.money.toFixed(2));      
                        })
                        $("#tbody_r1_c6").html(yslTotal);       
                        $("#tbody_r1_c8").html(moneyTotal.toFixed(2));
                    }
                }),
                //内部用气
                $.ajax({
                    url: "hzqs/dbc/pbsel.do?fh=SELDBC0000000J00&resp=bd",
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({
                        cols: "sum(gas) ysl,sum(sse) money, areaId",
                        froms: "gasReportYslNewDiff",
                        wheres: whereClause14_16 + " group by areaId",
                        page: "false",
                    }),
                    dataType: "json",
                    success: function (data) {
                        
                        var yslTotal=0,moneyTotal=0.00;
                        $("#tbody").find("tr").each(function(){
                            var areaId=$(this).data("areaid");
                            var m=getReportAreaIdNum(data.rows,areaId) ;
                            if(areaId!=areaIdTotal){
                                yslTotal+=m.ysl;
                                moneyTotal+=m.money;
                            } 
                            $(this).find("#tbody_r"+areaId+"_c14").html(m.ysl);       
                            $(this).find("#tbody_r"+areaId+"_c16").html(m.money.toFixed(2));      
                        })
                        $("#tbody_r1_c14").html(yslTotal);       
                        $("#tbody_r1_c16").html(moneyTotal.toFixed(2));
                    }
                }),
                $.ajax({
                    url: "hzqs/dbc/pbsel.do?fh=SELDBC0000000J00&resp=bd",
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({
                        cols: "sum(gas) ysl,sum(sse) money, areaId",
                        froms: "gasReportYslNewDiff",
                        wheres: whereClause2 + " group by areaId",
                        page: "false",
                    }),
                    dataType: "json",
                    success: function (data) {
                        var yslTotal=0,moneyTotal=0.00;
                        $("#tbody").find("tr").each(function(){
                            var areaId=$(this).data("areaid");
                            var m=getReportAreaIdNum(data.rows,areaId) ;
                            $(this).find("#tbody_r"+areaId+"_c2").attr("data-ysl",m.ysl);       
                            $(this).find("#tbody_r"+areaId+"_c4").attr("data-money",m.money.toFixed(2));      
                        })
                    }
                }),

            ).then(function(){
                var td2Total=0.00;
                $("#tbody").find("tr").each(function(){
                    var areaId=$(this).data("areaid");
                    if(areaId==23){
                        var ysl=parseInt($(this).find("#tbody_r"+areaId+"_c2").data("ysl"));
                        $(this).find("#tbody_r"+areaId+"_c2").html(ysl)
                    }
                    var c2=$(this).find("#tbody_r"+areaId+"_c2").text();
                    var c6=$(this).find("#tbody_r"+areaId+"_c6").text();
                    var c4=$(this).find("#tbody_r"+areaId+"_c4").text();
                    var c8=$(this).find("#tbody_r"+areaId+"_c8").text();
                    var c14=$(this).find("#tbody_r"+areaId+"_c14").text();
                    var c16=$(this).find("#tbody_r"+areaId+"_c16").text();
                    var c10=c2-c6;
                    var c12=(c4-c8).toFixed(2);
                    $(this).find("#tbody_r"+areaId+"_c10").html(c2-c6);
                    $(this).find("#tbody_r"+areaId+"_c12").html(c12);
                    $(this).find("#tbody_r"+areaId+"_c18").html(c10+c14);
                    var c20=parseFloat(c12)+parseFloat(c16);
                    $(this).find("#tbody_r"+areaId+"_c20").html(c20);
                    if(c2){
                        td2Total+=parseInt(c2);
                    }
                    console.log("c2",parseInt(c2))
                })
                $("#tbody_r1_c2").html(td2Total);
            })
            //总完成 累计实收量和累计实收额
            var whereClause3_5=" reportYear="+year+" and reportMonth<="+month     
            
            //当年 新增用户 累计销量和累计销售额
            var whereClause7_9=" reportYear="+year+" and reportMonth<="+month
            whereClause7_9+=" and unboltTime between to_date('"+startYear+"','yyyy-MM-dd') and to_date('"+end+"','yyyy-MM-dd')";
            
            var whereClause15_17=" reportYear="+year+" and reportMonth<="+month
            whereClause15_17+=" and gasTypeId like '308%'";
            $.when(
                $.ajax({
                    url: "hzqs/dbc/pbsel.do?fh=SELDBC0000000J00&resp=bd",
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({
                        cols: "sum(ysl) ysl,sum(money) money, areaId",
                        froms: "gasReportSseNewDiff",
                        wheres: whereClause3_5 + " group by areaId",
                        page: "false",
                    }),
                    dataType: "json",
                    success: function (data) {
                        var yslTotal=0,moneyTotal=0.00;
                        $("#tbody").find("tr").each(function(){
                            var areaId=$(this).data("areaid");
                            var m=getReportAreaIdNum(data.rows,areaId) ;
                            if(areaId!=areaIdTotal){
                                yslTotal+=m.ysl;
                                moneyTotal+=m.money;
                            } 
                            $(this).find("#tbody_r"+areaId+"_c3").html(m.ysl);       
                            $(this).find("#tbody_r"+areaId+"_c5").html(m.money.toFixed(2));      
                        })
                        $("#tbody_r1_c3").html(yslTotal);       
                        $("#tbody_r1_c5").html(moneyTotal.toFixed(2));
                    }
                }),
                $.ajax({
                    url: "hzqs/dbc/pbsel.do?fh=SELDBC0000000J00&resp=bd",
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({
                        cols: "sum(ysl) ysl,sum(money) money, areaId",
                        froms: "gasReportSseNewDiff",
                        wheres: whereClause7_9 + " group by areaId",
                        page: "false",
                    }),
                    dataType: "json",
                    success: function (data) {
                        var yslTotal=0,moneyTotal=0.00;
                        $("#tbody").find("tr").each(function(){
                            var areaId=$(this).data("areaid");
                            var m=getReportAreaIdNum(data.rows,areaId) ;
                            if(areaId!=areaIdTotal){
                                yslTotal+=m.ysl;
                                moneyTotal+=m.money;
                            } 
                            $(this).find("#tbody_r"+areaId+"_c7").html(m.ysl);       
                            $(this).find("#tbody_r"+areaId+"_c9").html(m.money.toFixed(2));      
                        })
                        $("#tbody_r1_c7").html(yslTotal);       
                        $("#tbody_r1_c9").html(moneyTotal.toFixed(2));
                    }
                }),
                $.ajax({
                    url: "hzqs/dbc/pbsel.do?fh=SELDBC0000000J00&resp=bd",
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({
                        cols: "sum(gas) ysl,sum(sse) money, areaId",
                        froms: "gasReportYslNewDiff",
                        wheres: whereClause15_17 + " group by areaId",
                        page: "false",
                    }),
                    dataType: "json",
                    success: function (data) {
                        var yslTotal=0,moneyTotal=0.00;
                        $("#tbody").find("tr").each(function(){
                            var areaId=$(this).data("areaid");
                            var m=getReportAreaIdNum(data.rows,areaId) ;
                            if(areaId!=areaIdTotal){
                                yslTotal+=m.ysl;
                                moneyTotal+=m.money;
                            } 
                            $(this).find("#tbody_r"+areaId+"_c15").html(m.ysl);       
                            $(this).find("#tbody_r"+areaId+"_c17").html(m.money.toFixed(2));      
                        })
                        $("#tbody_r1_c15").html(yslTotal);       
                        $("#tbody_r1_c17").html(moneyTotal.toFixed(2));
                    }
                })
            ).then(function(){
                $("#tbody").find("tr").each(function(){
                    var areaId=$(this).data("areaid");
                    var c3=$(this).find("#tbody_r"+areaId+"_c3").text();
                    var c7=$(this).find("#tbody_r"+areaId+"_c7").text();
                    var c5=$(this).find("#tbody_r"+areaId+"_c5").text();
                    var c9=$(this).find("#tbody_r"+areaId+"_c9").text();
                    var c15=$(this).find("#tbody_r"+areaId+"_c15").text();
                    var c17=$(this).find("#tbody_r"+areaId+"_c17").text();
                    var c11=c3-c7;
                    var c13=(c5-c9).toFixed(2);
                    $(this).find("#tbody_r"+areaId+"_c11").html(c3-c7);
                    $(this).find("#tbody_r"+areaId+"_c13").html(c13);
                    $(this).find("#tbody_r"+areaId+"_c19").html(c11+c15);
                    var c21=parseFloat(c13)+parseFloat(c17);
                    $(this).find("#tbody_r"+areaId+"_c21").html(c21);
                })
            })
        });

    });
</script><!-- End of User Script-->
</html>